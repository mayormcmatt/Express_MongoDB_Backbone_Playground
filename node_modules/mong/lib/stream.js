'use strict';

var util = require('util');

module.exports = QueryStream;

var Readable = require('stream').Readable;

util.inherits(QueryStream, Readable);

function QueryStream(cursor, prototype) {
  this._cursor = cursor;
  this._prototype = prototype;
  Readable.call(this, {objectMode: true});
}

QueryStream.prototype._read = function () {
  var stream = this;
  var prototype = this._prototype;
  this._cursor.nextObject(function (err, doc) {
    if (err) {
      console.error('ERRRR', err);
      throw err;
    }
    if (doc) doc.__proto__ = prototype;
    stream.push(doc);
  });
};